# Create Item - API Payload Guide

## ðŸ“¤ FormData Fields Being Sent

When you create an item with these values in the form:

### **Form Input:**
```
Name: Gold Ring
Description: Beautiful 18k gold ring
Category: Ring
Gross Weight: 10.5
Net Weight: 9.2
Source: Local Supplier
HUID: HUID123456
Images: [file1.jpg, file2.jpg]
```

### **Actual API Payload (FormData):**
```
POST http://localhost:3000/api/items
Content-Type: multipart/form-data

FormData:
  name: "Gold Ring"
  category: "Ring"
  source: "Local Supplier"
  grossWeight: "10.5"
  netWeight: "9.2"
  huid: "HUID123456"
  description: "Beautiful 18k gold ring"  (optional - only if filled)
  images: [Blob] file1.jpg
  images: [Blob] file2.jpg
```

---

## ðŸ” Debug Logging

The application now logs the payload to the browser console:

### **Console Output (Check Browser DevTools):**
```javascript
Creating item with data: {
  name: "Gold Ring",
  category: "Ring",
  source: "Local Supplier",
  grossWeight: 10.5,
  netWeight: 9.2,
  huid: "HUID123456",
  description: "Beautiful 18k gold ring",
  imageCount: 2
}
```

### **Success Response:**
```javascript
Item created successfully: {
  item: {
    _id: "65f1a2b3c4d5e6f7a8b9c0d1",
    itemCode: "R0001",  // Auto-generated by backend
    name: "Gold Ring",
    category: "Ring",
    source: "Local Supplier",
    grossWeight: 10.5,
    netWeight: 9.2,
    huid: "HUID123456",
    description: "Beautiful 18k gold ring",
    stockQty: 1,  // Set by backend
    images: ["uploads/items/1234567890.jpg", "uploads/items/1234567891.jpg"],
    createdAt: "2024-11-02T10:30:00.000Z",
    updatedAt: "2024-11-02T10:30:00.000Z"
  }
}
```

---

## ðŸŽ¯ Field Details

### **Required Fields** âœ…
All these fields MUST be filled:

| Field | Type | Example | Notes |
|-------|------|---------|-------|
| `name` | string | "Gold Ring" | Item name |
| `category` | string | "Ring" | Category (triggers auto-code generation) |
| `source` | string | "Local Supplier" | Vendor/supplier name |
| `grossWeight` | number | 10.5 | In grams, must be > 0 |
| `netWeight` | number | 9.2 | In grams, must be > 0 |
| `huid` | string | "HUID123456" | Hallmark Unique ID |

### **Optional Fields** âšª
| Field | Type | Example | Notes |
|-------|------|---------|-------|
| `description` | string | "Beautiful 18k gold ring" | Only sent if not empty |
| `images` | File[] | [file1, file2] | 0-5 images, optional |

### **Auto-Generated by Backend** ðŸ¤–
These are NOT sent from frontend:

| Field | Generated By | Example |
|-------|-------------|---------|
| `itemCode` | Backend based on category | "R0001", "GR0001", "LR0001" |
| `stockQty` | Backend default | 1 |
| `_id` | MongoDB | "65f1a2b3c4d5e6f7a8b9c0d1" |
| `createdAt` | Backend timestamp | "2024-11-02T10:30:00.000Z" |
| `updatedAt` | Backend timestamp | "2024-11-02T10:30:00.000Z" |

---

## ðŸ“‹ Category â†’ Item Code Mapping

Backend auto-generates item codes based on category:

| Category Selected | Item Code Prefix | Example Codes |
|------------------|------------------|---------------|
| Ring | R | R0001, R0002, R0003... |
| Gents ring | GR | GR0001, GR0002, GR0003... |
| Ladies ring | LR | LR0001, LR0002, LR0003... |
| Necklace | N or NC | N0001, N0002... |
| Earring | E or ER | E0001, E0002... |
| Bracelet | B or BR | B0001, B0002... |
| Pendant | P or PD | P0001, P0002... |
| Anklet | A or AN | A0001, A0002... |

*Note: Exact prefixes depend on backend configuration*

---

## ðŸ§ª Testing Steps

### 1. **Open Browser DevTools**
- Press F12
- Go to Console tab
- Go to Network tab

### 2. **Fill the Create Item Form**
```
Name: Gold Ring
Description: Beautiful 18k gold ring
Category: Ring
Source: Local Supplier
Gross Weight: 10.5
Net Weight: 9.2
HUID: HUID123456
Images: Upload 1-2 images
```

### 3. **Click "Create Item"**

### 4. **Check Console Tab**
You should see:
```
Creating item with data: { name: "Gold Ring", category: "Ring", ... }
```

### 5. **Check Network Tab**
- Find request to `POST /api/items`
- Click on it â†’ Payload tab
- You'll see FormData with all fields

### 6. **Check Response**
- Should see status 201 Created
- Response body shows created item with auto-generated itemCode

---

## âŒ Common Errors & Solutions

### **Error 1: "Please fill in all required fields"**
**Cause:** Missing name, category, source, grossWeight, netWeight, or HUID  
**Solution:** Fill all fields marked with * (red asterisk)

### **Error 2: "Weight must be greater than 0"**
**Cause:** Gross or Net weight is 0 or negative  
**Solution:** Enter positive weight values (e.g., 10.5)

### **Error 3: "Maximum 5 images allowed"**
**Cause:** More than 5 images selected  
**Solution:** Remove extra images, keep max 5

### **Error 4: 400 Bad Request**
**Cause:** Backend validation failed  
**Solution:** Check console error message, verify all fields match backend requirements

### **Error 5: 401 Unauthorized**
**Cause:** Not logged in or token expired  
**Solution:** Log in again

---

## ðŸ”§ FormData Construction Code

The exact code that builds the payload:

```typescript
const formData = new FormData();

// Append all required fields
formData.append('name', this.itemData.name);
formData.append('category', this.itemData.category);
formData.append('source', this.itemData.source);
formData.append('grossWeight', this.itemData.grossWeight.toString());
formData.append('netWeight', this.itemData.netWeight.toString());
formData.append('huid', this.itemData.huid);

// Append optional description if provided
if (this.itemData.description && this.itemData.description.trim() !== '') {
  formData.append('description', this.itemData.description);
}

// Append images (max 5)
this.files.slice(0, 5).forEach((file) => {
  formData.append('images', file, file.name);
});

// Send to API
this.itemService.createItem(formData).subscribe(...)
```

---

## âœ… Verification Checklist

Before clicking "Create Item":

- [ ] Name is filled âœ“
- [ ] Category is selected âœ“
- [ ] Source/Vendor is filled âœ“
- [ ] Gross Weight > 0 âœ“
- [ ] Net Weight > 0 âœ“
- [ ] HUID is filled âœ“
- [ ] Images uploaded (optional, max 5) âšª
- [ ] Browser console is open (F12) âœ“

After clicking "Create Item":

- [ ] Check console logs for payload âœ“
- [ ] Check network tab for request âœ“
- [ ] Check for success/error message âœ“
- [ ] If success, verify redirect to inventory list âœ“
- [ ] Verify new item appears in list with auto-generated code âœ“

---

## ðŸ“ž Backend API Expected Format

According to Postman collection:

```
POST /api/items
Content-Type: multipart/form-data

Required:
  - name (string)
  - category (string)
  - grossWeight (number)
  - netWeight (number)
  - source (string)
  - huid (string)
  - images (file array, 1-5 files)

Optional:
  - description (string)

Backend Response:
{
  "item": {
    "_id": "...",
    "itemCode": "R0001",  // Auto-generated
    "name": "Gold Ring",
    "category": "Ring",
    ...
  }
}
```

---

**Last Updated:** November 2025  
**Status:** âœ… All fields properly configured and sending to backend
